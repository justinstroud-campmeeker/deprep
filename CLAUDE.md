# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This console application produces a report of dependencies given a path to Apex classes and triggers.

Dependencies are defined as such:
- Apex classes that are referenced by a trigger
- Apex classes that are referenced by a trigger field
- Apex classes that are referenced by another Apex class
- Built-in classes that are referenced by a trigger
- Built-in classes that are referenced by an Apex class

Given feedback, it may be expanded to include other metadata types.

This tool uses tree-sitter to parse Apex code and extract the dependency information.

The output format is as follows, although this is configurable:

MyApexClass:ApexClass;SomeDependency:ApexClass;AnotherDependency:ApexClass;String:SystemType;SomeCustomObject__c:CustomObject

The first item (MyApexClass) is the root object. All that follow are dependencies.

Each item is formatted as [name]:[type of object]. Entries are separated by semicolons. 

The "type of object" can be:
- ApexClass
- CustomObject
- SystemType
- Trigger
- TriggerField
- CustomField
- CustomLabel
- CustomValidationRule
- CustomApplication
- CustomPage
- ApexInterface
- ApexEnum
- ApexTrigger
- ApexPage
- ApexComponent
- ApexPageComponent
- ApexPageSection
- ApexPageRegion
- ApexPageItem
- ApexPageWebLink

## Build and Development Commands

- **Build**: `npm run build` - Compiles TypeScript to JavaScript in the `dist` directory
- **Install dependencies**: `npm install`
- **Test**: `npm test` - Builds and runs the application on test data
- **Run**: `npm start` or `node dist/index.js` - Execute the application

## Usage

The application provides a command-line interface:

```bash
deprep <path> [options]
```

### Arguments
- `path` - Path to Apex classes and triggers (file or directory)

### Options
- `--separator, -s` - Separator character for output (default: ;)
- `--recursive, -r` - Recursively scan subdirectories
- `--help, -h` - Show help message

### Examples
```bash
# Analyze a single file
deprep ./classes/MyClass.cls

# Analyze all files in a directory recursively
deprep ./src --recursive

# Use custom separator
deprep ./triggers --separator "|"
```

## Project Structure

The application is structured as follows:
- `src/index.ts` - Main entry point and CLI argument parsing
- `src/cli.ts` - Command-line interface implementation
- `src/parser.ts` - Tree-sitter Apex parsing and dependency extraction
- `src/formatter.ts` - Output formatting logic
- `src/types.ts` - TypeScript type definitions and enums
- `dist/` - Compiled JavaScript output (generated by TypeScript compiler)

## Dependencies

The application uses:
- `tree-sitter` - Core parsing library
- `tree-sitter-sfapex` - Salesforce Apex grammar for tree-sitter
- `@types/node` - Node.js type definitions

## TypeScript Configuration

The project uses strict TypeScript compilation with:
- Target: ES2016
- Module system: CommonJS
- Output directory: `dist`
- Strict type checking enabled
- All source files in `src` directory are included

## Implementation Notes

- The parser identifies system types (String, Database, System, etc.) and classifies them appropriately
- Custom objects are detected by `__c` or `__r` suffixes
- Custom fields are detected by `__c` suffix
- The application supports both Apex classes (`.cls`) and triggers (`.trigger`)
- Dependencies are deduplicated in the output
- Root object type is automatically determined based on file content and extension